# 测试及改进

## 测试结果

- 测试工具为ab，测试请求数量为10000次，并发数及工作线程数为测试内容。

- 测试环境为本地虚拟机，配置1核心i5处理器。

**100并发量**

在100并发量下，并未因线程数增多性能有所提升，相反吞吐量还略微下降，在这种IO请求并不是较密集的情况下，通常线程数为CPU核心数较好。在测试中 4线程下一共请求50000次，全部成功。另外，在满负荷情况下HSpeed总CPU使用率约40%（10% * 4threads或5% * 8threads）。
- 4工作线程

    - 性能结果

        ![4worker](./test_pic/压测结果(4线程100并发).png)

	- 系统负载
		
		![4worker](./test_pic/系统负载(4线程100并发).png)


- 8工作线程（结果）

    - 性能结果
    
        ![8worker](./test_pic/压测结果(8线程100并发).png)

    - 系统负载

        ![8works](./test_pic/系统负载(8线程100并发).png)

**500并发量**

在500并发量下，可以看到无论是4线程或者是8线程每个请求花费的时间都是成几倍的增加，所以理所当然的，高并发下的吞吐量都是少于并发数目较低的情况的。同时我们可以发现，面对不同并发数目测试，在满负荷下进程所占有的总CPU使用率是大致相同的。这并不难理解，虽然并发数目不同，但是运行环境还是相同，代码结构也未变。所以如果还想要面对更大的并发请求的话，修改代码与增加机器都是必不可少的。
- 4工作线程

    - 性能结果

        ![4worker](./test_pic/压测结果(4线程500并发).png)

　　- 系统负载
　　
　　![4works](./test_pic/系统负载(4线程500并发).png)

- 8工作线程（结果）

    - 性能结果
    
        ![8worker](./test_pic/压测结果(8线程500并发).png)

    - 系统负载

        ![8works](./test_pic/系统负载(8线程500并发).png)


---
